!function(){var e;(e=jQuery)(document).ready((function(){var t,a,n=e("#gform-settings"),c=n.find('input[name="gf_recaptcha_action"]');if("gf_recaptcha_v3_classic"===c.val()?(a={init:function(){a.token="",a.strings=gforms_recaptcha_recaptcha_strings,a.cacheElements(),a.validateKeysV3(),a.addEventListeners()},cacheElements:function(){a.fields={siteKey:"#site_key_v3",secretKey:"#secret_key_v3",threshold:"#score_threshold_v3",disableBadge:"#disable_badge_v3",keysStatus:"#gform_setting_recaptcha_keys_status_v3"},a.cache={siteKey:e(a.fields.siteKey),secretKey:e(a.fields.secretKey),keysStatus:e(a.fields.keysStatus),save:e("#gform-settings-save")}},addEventListeners:function(){a.strings.site_key.length&&(e(a.fields.siteKey).on("keyup",(function(){return a.clearValidationFeedback()})),e(a.fields.secretKey).on("keyup",(function(){return a.clearValidationFeedback()})))},clearValidationFeedback:function(){a.unsetValid(a.cache.siteKey.closest(".gform-settings-input__container")),a.unsetValid(a.cache.secretKey.closest(".gform-settings-input__container"))},getRecaptchaToken:function(){return new Promise((function(t,n){var c=a.cache.siteKey.closest(".gform-settings-input__container");try{var s=a.cache.siteKey.val().trim();if(0===s.length)return a.unsetValid(c),a.unsetValid(a.cache.keysStatus.closest(".gform-settings-input__container")),void e(a.fields.keysStatus).find("input").val("0");grecaptcha.ready((function(){try{grecaptcha.execute(s,{action:"submit"}).then((function(e){t(e)}))}catch(e){n(e)}}))}catch(e){n(e)}}))},validateKeysV3:function(){var t=a.cache.siteKey.closest(".gform-settings-input__container"),n=a.cache.secretKey.closest(".gform-settings-input__container"),c=e(a.fields.keysStatus).find("input");if(!e(a.fields.siteKey).val().trim().length)return a.unsetValid(t),a.unsetValid(n),void c.val("0");a.getRecaptchaToken().then((function(e){a.token=e})).catch((function(){a.setInvalid(t),a.setInvalid(n),c.val("0")})).finally((function(){e.ajax({method:"POST",dataType:"JSON",url:ajaxurl,data:{action:"verify_secret_key",nonce:a.strings.nonce,token:a.token,site_key_v3:e(a.fields.siteKey).val(),secret_key_v3:e(a.fields.secretKey).val()}}).then((function(e){switch(e.data.keys_status){case"1":a.setValid(t),a.setValid(n),c.val("1");break;case"0":a.setInvalid(t),a.setInvalid(n),c.val("0");break;default:a.unsetValid(t),a.unsetValid(n),c.val("0")}}))}))},unsetValid:function(e){e.removeClass("gform-settings-input__container--feedback-success"),e.removeClass("gform-settings-input__container--feedback-error")},setValid:function(e){e.addClass("gform-settings-input__container--feedback-success"),e.removeClass("gform-settings-input__container--feedback-error")},setInvalid:function(e){e.removeClass("gform-settings-input__container--feedback-success"),e.addClass("gform-settings-input__container--feedback-error")}}).init():"gf_recaptcha_v2"===c.val()&&(t={init:function(){t.cacheElements(),t.addEventListeners()},cacheElements:function(){t.container=e('div[id="gform_setting_reset_v2"]'),t.fields={siteKey:e('input[name="_gform_setting_site_key_v2"]'),secretKey:e('input[name="_gform_setting_secret_key_v2"]'),reset:e('input[name="_gform_setting_reset_v2"]'),type:e('input[name="_gform_setting_type_v2"]')}},addEventListeners:function(){t.fields.siteKey.on("change",window.loadRecaptcha),t.fields.secretKey.on("change",window.loadRecaptcha),t.fields.type.on("change",(function(){return window.loadRecaptcha()}))}},window.loadRecaptcha=function(){var a={init:function(){t.recaptcha=e("#recaptcha"),t.save=e("#gform-settings-save"),a.flushExistingState(),e("#recpatcha .gform-settings-field__feedback").remove(),a.canBeDisplayed()?a.showSelectedRecaptcha():a.hideRecaptcha()},render:function(e){grecaptcha.render("recaptcha",{sitekey:t.fields.siteKey.val().trim(),size:"invisible"===e?e:"",badge:"inline","error-callback":function(){},callback:function(){return t.save.prop("disabled",!1)}})},flushExistingState:function(){window.___grecaptcha_cfg.clients={},window.___grecaptcha_cfg.count=0,t.recaptcha.html(""),t.fields.reset.val("1")},canBeDisplayed:function(){return t.fields.siteKey.val()&&t.fields.secretKey.val()},hideRecaptcha:function(){t.save.prop("disabled",!1),t.container.hide()},showSelectedRecaptcha:function(){var n=e('input[name="_gform_setting_type_v2"]:checked').val();if(n){switch(a.render(n),n){case"checkbox":e('#gforms_checkbox_recaptcha_message, label[for="reset"]').show();break;case"invisible":e('#gforms_checkbox_recaptcha_message, label[for="reset"]').hide();break;default:throw new Error("Unexpected type selected.")}t.container.show(),"invisible"===n&&grecaptcha.execute()}}};a.init()},t.init()),gforms_recaptcha_recaptcha_strings.disable_badge){var s=document.querySelector(".grecaptcha-badge");s&&(s.style.visibility="hidden")}var i=e(".gfrecaptcha-disconnect");i.length>0&&i.on("click",(function(t){t.preventDefault();var a=e("#site_key_v3"),n=e("#site_key_v2"),c=!1;if(a.length>0&&""!==a.val()&&(c=!0),n.length>0&&""!==n.val()&&(c=!0),c||i.hasClass("gfrecaptcha-disconnect")){if(i.hasClass("gfrecaptcha-disconnect"))var s=gforms_recaptcha_recaptcha_strings.disconnect_title,r=gforms_recaptcha_recaptcha_strings.disconnect_message;else s=gforms_recaptcha_recaptcha_strings.change_connection_type_title,r=gforms_recaptcha_recaptcha_strings.change_connection_type_message;if("function"!=typeof gform.instances.dialogConfirmAsync){if(!confirm(r))return}else gform.instances.dialogConfirmAsync(s,r).then((function(e){}))}i.hasClass("gfrecaptcha-changetype")?i.html(gforms_recaptcha_recaptcha_strings.change_connection_type):i.html(gforms_recaptcha_recaptcha_strings.disconnect);var o=wpAjax.unserialize(t.target.href).nonce;e.post(ajaxurl,{action:"disconnect_recaptcha",nonce:o},(function(e){window.location.href=window.location.href}))})),n.on("submit",(function(t){if(1!==n.find('input[value="recaptcha_setup"]').length){if("gf_recaptcha_enterprise"===c.val()){t.preventDefault();var a=n.find('select[name="recaptcha_project"]').find(":selected"),s=n.find("#recaptcha-site-keys :selected");e.post(ajaxurl,{action:"save_recaptcha_enterprise_data",project_number:a.val(),project_id:a.data("project-id"),project_name:a.data("project-name"),site_key_v3_enterprise:s.val(),site_key_display_name:s.data("site-key-display-name"),score_threshold_v3:n.find("#score_threshold_v3").val(),disable_badge_v3:n.find('input[name="_gform_setting_disable_badge_v3"]').val(),nonce:n.find('input[name="recaptcha_nonce"]').val()},(function(e){e.success&&(window.location.href=e.data)}))}}else{t.preventDefault(),n.find("#gform-settings-save");var i=n.find('[name="_gform_setting_connection_type"]:checked').val(),r=n.find('input[name="recaptcha_nonce"]').val();"enterprise"===i?e.post(ajaxurl,{action:"perform_enterprise_oauth",nonce:r,mode:i},(function(e){e.data.errors||(window.location.href=e.data.redirect)}),"json"):e.post(ajaxurl,{action:"update_reload_settings",nonce:r,connection_type:i},(function(e){if(!e.data.errors){var t=new URL(e.data.redirect);t.searchParams.set("connection_type",i),window.location.href=t}}),"json")}})),e("#recaptcha_project").on("change",(function(t){var a=e(this).find(":selected"),n=e("body").find('input[name="recaptcha_nonce"]').val();e("#recaptcha-site-keys").html('<br /><img src="'+gforms_recaptcha_recaptcha_strings.spinner+'" />'),e.post(ajaxurl,{action:"get_enterprise_site_keys",project:a.val(),nonce:n},(function(t){if(t.success){var a=t.data,n=document.createElement("select");n.name="recaptcha-site-keys";var c=document.createElement("label");c.textContent="Enterprise Site Key",c.setAttribute("for","recaptcha-site-keys"),c.classList.add("gform-settings-label");var s=document.createElement("div");s.classList.add("gform-settings-field__header"),s.appendChild(c);var i=document.createElement("option");i.value="",i.textContent="Select a site key",n.appendChild(i),a.forEach((function(e){var t=document.createElement("option");t.value=e.value,t.textContent=e.displayName,t.setAttribute("data-site-key-display-name",e.displayName),n.appendChild(t)}));var r=document.querySelector("#recaptcha-site-keys");r.innerHTML="",r.appendChild(s),r.appendChild(n)}else e("#recaptcha-site-keys").html("")}))})),gform.adminUtils.handleUnsavedChanges("#gform-settings")}))}();