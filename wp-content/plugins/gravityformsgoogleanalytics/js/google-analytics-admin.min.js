!function(d){function g(a){d(".gforms_note_error").remove(),d("#gform-page-loader-mask").hide(),d("#gform-settings").before('<div class="alert gforms_note_error" role="alert">'+a+"</div>"),d(".alert").get(0).scrollIntoView()}function l(){d(".gforms_note_error").remove()}jQuery(document).ready(function(){let s=d("#gform-settings"),e=d(".gfga-disconnect"),i=(0<e.length&&e.on("click",function(a){a.preventDefault(),e.html(google_analytics_admin_strings.disconnect);a=wpAjax.unserialize(a.target.href).nonce;d.post(ajaxurl,{action:"disconnect_account",nonce:a},function(a){window.location.href=window.location.href})}),s.find('input[name="gfgaaction"]'));0!==i.length&&"manual"!==i.val()&&s.find(":submit").prop("disabled",!0),d("#gform-settings-section-google-analytics-settings").on("change","input, select",function(a){var e=s.find('select[name="gaproperty"]').find(":selected").val(),n=d("#ga-data-streams select :selected").val();let t=s.find('select[name="gtmproperty"]').find(":selected").val(),o=(t=t||s.find("#container").val(),s.find('select[name="gaworkspace"]').val());o=o||s.find("#workspace").val();var r=s.find(":submit");"ga"===i.val()&&(e&&n?r.prop("disabled",!1):r.prop("disabled",!0)),"gtm"===i.val()&&(t&&o?r.prop("disabled",!1):r.prop("disabled",!0))}),s.on("submit",function(a){var e,n,t,o,r,i,c;l(),1===s.find('input[value="google_analytics_setup"]').length?(a.preventDefault(),e=s.find("#gform-settings-save"),n=s.find('[name="_gform_setting_mode"]:checked').val(),e.prop("value",google_analytics_admin_strings.redirect).prop("disabled","disabled"),e=s.find('input[name="gfganonce"]').val(),d.post(ajaxurl,{action:"redirect_to_api",nonce:e,mode:n},function(a){a.data.errors||(window.location.href=a.data.redirect)},"json")):0!==(e=s.find('input[name="gfgaaction"]')).length&&("ga"===e.val()&&(a.preventDefault(),n=s.find('select[name="gaproperty"]').find(":selected"),t=s.find("#ga-data-streams select :selected"),d.post(ajaxurl,{action:"save_google_analytics_data",account_id:n.data("account-id"),account_name:n.data("account-name"),property_id:n.val(),property_name:n.data("property-name"),measurement_id:t.val(),data_stream_name:t.data("data-stream-name"),data_stream_id:t.data("data-stream-id"),nonce:s.find('input[name="gfganonce"]').val(),token:s.find('input[name="gfga_token"]').val(),refresh:s.find('input[name="gfga_refresh"]').val()},function(a){a.success?window.location.href=a.data:g(a.data[0].message)})),"gtm"===e.val()&&(a.preventDefault(),n=s.find('select[name="gaproperty"]').find(":selected"),t=s.find("#ga-data-streams select :selected"),o=s.find('select[name="gtmproperty"] :selected'),r=s.find('select[name="gacontainer"] :selected'),i=s.find('select[name="gaworkspace"] :selected'),c=s.find('input[name="_gform_setting_gtm_auto_create"]'),d.post(ajaxurl,{action:"save_google_tag_manager_data",account_id:n.data("account-id"),account_name:n.data("account-name"),property_id:n.val(),property_name:n.data("property-name"),measurement_id:t.val(),data_stream_name:t.data("data-stream-name"),gtm_account_id:o.data("account-id"),gtm_account_name:o.val(),gtm_api_path:r.data("path"),gtm_container:r.val(),gtm_auto_create:c.val(),gtm_workspace_id:i.val(),gtm_workspace_name:i.text(),nonce:s.find('input[name="gfganonce"]').val(),token:s.find('input[name="gfga_token"]').val(),refresh:s.find('input[name="gfga_refresh"]').val()},function(a){!1===a.success?g(a.data[0].message):window.location.href=a.data})),"manual"===e.val())&&(a.preventDefault(),d.post(ajaxurl,{action:"save_manual_configuration_data",mode:s.find("#ga_connection_type").val(),measurement_id:s.find("#ga_measurement_id").val(),gmp_api_secret:s.find("#gmp_api_secret").val(),gtm_container:s.find("#gtm_container_id").val(),gtm_workspace_id:s.find("#gtm_workspace_id").val(),nonce:s.find('input[name="gfganonce"]').val()},function(a){!1===a.success?g(a.data[0].message):window.location.href=a.data}))}),d("#gaproperty").on("change",function(a){l();var e=d(this).find(":selected"),n=d("body").find('input[name="gfganonce"]').val(),t=s.find('input[name="gfga_token"]').val();d("#ga-data-streams").html('<br /><img src="'+google_analytics_admin_strings.spinner+'" />'),d.post(ajaxurl,{action:"get_ga4_data_streams",account:e.data("account-id"),property:e.val(),nonce:n,token:t},function(a){a.success?d("#ga-data-streams").html(a.data):(d("#ga-data-streams").html(""),g(a.data[0].message))})}),d("#gtmproperty").on("change",function(a){l();var e=d(this).find(":selected"),n=e.data("accountId"),t=e.data("path"),e=e.data("token"),o=d("body").find('input[name="gfganonce"]').val();d("#gtm-containers").html('<br /><img src="'+google_analytics_admin_strings.spinner+'" />'),d("#gtm-workspaces").html(""),d.post(ajaxurl,{action:"get_gtm_containers",accountId:n,path:t,nonce:o,token:e},function(a){a.success?d("#gtm-containers").html(a.body):(g(a.data[0].message),d("#gtm-containers").html(""))})}),d(document).on("change","#gacontainer",function(a){l();var e=d(this).find(":selected"),n=e.data("path"),e=e.data("token"),t=d("body").find('input[name="gfganonce"]').val();d("#gtm-workspaces").html('<br /><img src="'+google_analytics_admin_strings.spinner+'" />'),d.post(ajaxurl,{action:"get_gtm_workspaces",path:n,nonce:t,token:e},function(a){a.success?d("#gtm-workspaces").html(a.body):(g(a.data[0].message),d("#gform_setting_workspace").show(),d("#gtm-workspaces").html(""))})}),d('[data-js="upgrade_ga_feeds"]').on("click",function(a){a.preventDefault(),confirm(google_analytics_admin_strings.upgrade_confirm)&&d.ajax({method:"POST",url:ajaxurl,data:{action:"gf_ga_upgrade_feeds",nonce:google_analytics_admin_strings.upgrade_feeds_nonce},success:function(a){(a.success?jQuery(".success-alert-container-upgrade"):jQuery(".error-alert-container-upgrade")).fadeIn()},error:function(a){jQuery(".error-alert-container-upgrade").fadeIn()},complete:function(a){setTimeout(function(){jQuery(".alert-container").fadeOut()},1e4)}})}),d('[data-js="restore_ga_feeds"]').on("click",function(a){a.preventDefault(),confirm(google_analytics_admin_strings.restore_confirm)&&d.ajax({method:"POST",url:ajaxurl,data:{action:"gf_ga_restore_feeds",nonce:google_analytics_admin_strings.restore_feeds_nonce},success:function(a){(a.success?jQuery(".success-alert-container-restore"):jQuery(".error-alert-container-restore")).fadeIn()},error:function(){jQuery(".error-alert-container-restore").fadeIn()},complete:function(){setTimeout(function(){jQuery(".alert-container").fadeOut()},1e4)}})})})}((window.GF_Google_Analytics_Admin=window.GF_Google_Analytics_Admin||{},jQuery));