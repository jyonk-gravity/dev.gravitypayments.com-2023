(function(){window.SPAIFront=function(){this.regExp={hoverRule:/.+::?hover\s.+/,backgroundUrl:/url\((?:`|'|")?([^`'"\)]+\.(?:jpe?g|png|gif)|data:image\/svg\+xml;base64[^`'"\)]+)(`|'|"|)?\s*\)/,imageUrl:/(?:https?:\\?\/\\?\/|\\?\/\\?\/)[^\s'"`]*\.(?:jpe?g|png|gif)/gmu};this.recommendedOptions={"lazy-load-backgrounds":false,"parse-css":false,"parse-json":false,"parse-js":false,"hover-handling":false};this.enabledOptions={};this.deferredSelectors=[];this.skippedURLs=[];this.cssFilesContent=[]};SPAIFront.prototype.htmlToElement=function(e){var t=document.createElement("template");e=e.trim();t.innerHTML=e;return t.content.firstChild};SPAIFront.prototype.isOtherInlineImage=function(e){if(e.indexOf("data:image")===0){let t=typeof ShortPixelAI.replacerService==="object"?ShortPixelAI.replacerService.parseInlinePseudoSrc(e):ShortPixelAI.parsePseudoSrc(e);if(t.src)return false}return typeof e!=="string"||e===""?false:e.indexOf("data:image")===0};SPAIFront.prototype.getCSSRules=function(e){var t=document.implementation.createHTMLDocument(""),n=document.createElement("style");n.textContent=e;t.body.appendChild(n);return n.sheet.cssRules};SPAIFront.prototype.parseStyles=function(e){var t=window.SPAIFrontWorker.getCSSRules(e);if(t.length>0){for(var n=0,o=t[n];n<t.length;o=t[++n]){if(typeof o.style==="object"&&typeof o.selectorText==="string"&&o.selectorText!==""){if(window.SPAIFrontWorker.regExp.hoverRule.test(o.selectorText)&&o.style.display!==""){var r=o.selectorText.split(",");r.forEach((function(e){e=e.trim();if(window.SPAIFrontWorker.regExp.hoverRule.test(e)){e=e.replace(/::?hover/,"");window.SPAIFrontWorker.deferredSelectors.push(e)}}))}}if(!window.SPAIFrontWorker.recommendedOptions["parse-css"]){if(typeof o.style==="object"&&o.style.backgroundImage!==""&&window.SPAIFrontWorker.regExp.backgroundUrl.test(o.style.backgroundImage)){var i=window.SPAIFrontWorker.regExp.backgroundUrl.exec(o.style.backgroundImage);if(i!==null){if(!window.SPAIFrontWorker.isOtherInlineImage(i[1])&&i[1].indexOf(window.SPAIFrontConstants.folderUrls.plugins)===-1&&i[1].indexOf(window.SPAIFrontConstants.folderUrls.includes)===-1){window.SPAIFrontWorker.recommendedOptions["parse-css"]=true}}}}}}};SPAIFront.prototype.parseImgURLs=function(){var e=document.querySelectorAll("img");if(e.length>0){e.forEach((function(e,t){var n=e.getAttribute("src");n=typeof n!=="string"?"":n;if(typeof window.SPAIFrontConstants==="object"){var o=n.indexOf(window.SPAIFrontConstants.apiUrl)>=0;if(!o){var r={element:e,url:n};if(window.SPAIFrontWorker.skippedURLs instanceof Array){window.SPAIFrontWorker.skippedURLs.push(r)}}}}))}};SPAIFront.prototype.parseCSS=function(){var e=document.querySelectorAll("style"),t=document.querySelectorAll('link[rel="stylesheet"]');if(e.length===0&&t.length===0){return}t.forEach((function(e){var t=e.getAttribute("href");if(typeof t==="string"&&t.indexOf(ShortPixelAI.getApiUrl().split("/").splice(0,4).join("/"))<0&&t.indexOf(document.location.host)>=0&&t.indexOf(document.location.host+"/"+window.SPAIFrontConstants.folderUrls.includes)===-1&&t.indexOf(document.location.host+"/"+window.SPAIFrontConstants.folderUrls.content+window.SPAIFrontConstants.folderUrls.plugins)===-1&&/\.css/.test(t)){var n=new XMLHttpRequest;n.onloadend=function(){if(window.SPAIFrontWorker.cssFilesContent){window.SPAIFrontWorker.cssFilesContent.push({url:t,content:n.response})}window.SPAIFrontWorker.parseStyles(n.response)};n.open("get",t,false);try{n.send()}catch(e){console.log(e.name+" thrown\t by xhr.send: "+e.message)}}}));e.forEach((function(e){window.SPAIFrontWorker.parseStyles(e.textContent)}))};SPAIFront.prototype.parseInlineStyles=function(){var e=document.querySelectorAll("div, span, body, article, section, i, p, h1, h2, h3, h4, h5, h6, form, img, figure, a");if(e.length>0){for(var t=0,n=e[t];t<e.length;n=e[++t]){if(n.style.backgroundImage!==""&&window.SPAIFrontWorker.regExp.backgroundUrl.test(n.style.backgroundImage)){window.SPAIFrontWorker.recommendedOptions["lazy-load-backgrounds"]=true;break}}}};SPAIFront.prototype.parseScripts=function(){var e=document.querySelectorAll("script");if(e.length>0){for(var t=0,n=e[t];t<e.length;n=e[++t]){if(n.textContent!==""){SPAIFrontWorker.regExp.imageUrl.lastIndex=0;do{if(window.SPAIFrontWorker.regExp.imageUrl.test(n.textContent)){var o=n.getAttribute("type");if(typeof o==="string"&&o!==""&&(o.indexOf("application/ld+json")!==-1||o.indexOf("application/json")!==-1)){var r=true;if(o.indexOf("application/ld+json")!==-1){try{var i=JSON.parse(n.innerText);if(i["@context"]!==undefined&&i["@graph"]!==undefined){r=false}}catch(e){}}window.SPAIFrontWorker.recommendedOptions["parse-json"]=r}else{window.SPAIFrontWorker.recommendedOptions["parse-js"]=true}break}}while(window.SPAIFrontWorker.regExp.imageUrl.lastIndex>=n.textContent.length);if(!!window.SPAIFrontWorker.recommendedOptions["parse-json"]&&!!window.SPAIFrontWorker.recommendedOptions["parse-js"]){break}}}}};SPAIFront.prototype.testDeferredSelectors=function(){if(window.SPAIFrontWorker.deferredSelectors.length===0){return}window.SPAIFrontWorker.deferredSelectors.forEach((function(e){var t=document.querySelectorAll(e);if(t.length>0){t.forEach((function(e){if(e instanceof HTMLElement&&e.tagName==="IMG"){window.SPAIFrontWorker.recommendedOptions["hover-handling"]=true}}))}}))};SPAIFront.prototype.prepareOptions=function(){var e=document.querySelector(".spai-fw-sidebar__body .spai__recommended-options-wrap"),t=e.querySelectorAll(".option"),n=document.querySelector(".spai-fw-sidebar__body .has-recommendations"),o=document.querySelector(".spai-fw-sidebar__body .no-recommendations"),r=document.querySelector(".spai-fw-sidebar__body .no-options"),i=document.querySelector(".spai-popup__wrap");var a=false,s=true,d=t instanceof NodeList&&t.length>0;if(i instanceof HTMLElement){i.classList.add("hidden")}for(var l in window.SPAIFrontWorker.recommendedOptions){var c=document.querySelector('.spai__recommended-options-wrap .option[data-option="'+l+'"]');if(c===null)continue;var p=c.querySelector('input[name="'+l+'"]');if(c instanceof HTMLElement){if(!window.SPAIFrontWorker.recommendedOptions[l]){c.parentNode.removeChild(c)}else{window.SPAIFrontWorker.enabledOptions[l]=p.checked;c.classList.remove("hidden");if(p instanceof HTMLElement){if(!p.checked){a=true}}else{a=true}}}}for(var l in window.SPAIFrontWorker.enabledOptions){if(window.SPAIFrontWorker.enabledOptions[l]===false){s=false;break}}if(a&&d){if(n instanceof HTMLElement){n.classList.remove("hidden")}}else if(!a&&d){if(o instanceof HTMLElement){o.classList.remove("hidden")}}if(s){if(r instanceof HTMLElement){r.classList.remove("hidden")}}document.dispatchEvent(new Event("show-sidebar"))};SPAIFront.prototype.scrollToBottom=function(){var e;e=setInterval((function(){if(window.scrollY+window.screen.availHeight<document.body.scrollHeight){window.scrollTo(0,window.scrollY+window.screen.availHeight>document.body.scrollHeight?document.body.scrollHeight:window.scrollY+window.screen.availHeight)}else{clearInterval(e);document.dispatchEvent(new Event("run-check"));window.scrollTo(0,0)}}),100)};SPAIFront.prototype.init=function(){if(typeof ShortPixelAI==="undefined"){setTimeout(SPAIFront.prototype.init,200);return}var e=document.createElement("div"),t=document.querySelector(".spai-fw-sidebar");e.className="spai-fw-body-content";document.addEventListener("show-sidebar",(function(){while(document.body.firstChild){e.appendChild(document.body.firstChild)}document.body.appendChild(e);document.body.insertBefore(t,e);document.body.classList.remove("spai-fw-sidebar-hidden")}));window.SPAIFrontWorker=new SPAIFront;window.SPAIFrontWorker.scrollToBottom()};if(document.readyState==="complete"){setTimeout(SPAIFront.prototype.init,1)}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",SPAIFront.prototype.init,false)}else{document.attachEvent("onreadystatechange",SPAIFront.prototype.init)}}})();(function(){var e=false;document.addEventListener("run-check",(function(){window.SPAIFrontWorker.parseImgURLs();window.SPAIFrontWorker.parseInlineStyles();window.SPAIFrontWorker.parseCSS();window.SPAIFrontWorker.parseScripts();window.SPAIFrontWorker.testDeferredSelectors();window.SPAIFrontWorker.prepareOptions()}));document.addEventListener("change",(function(t){var n=t.target;if(n.matches(".option input.tgl")){var o=n.parentElement.parentElement.querySelectorAll(".option input.tgl"),r=n.parentElement.parentElement.querySelector(".revert-confirmation"),i=n.parentElement.parentElement.parentElement.querySelector('.buttons-wrap[data-mission="general"]'),a=n.parentElement.parentElement.querySelector(".cache-message"),s=n.parentElement.parentElement.querySelector(".has-recommendations"),d=n.parentElement.parentElement.querySelector(".no-recommendations"),l=n.parentElement.parentElement.querySelector(".no-options");var c=true;if(n.checked===false){if(r instanceof HTMLElement){n.checked=true;n.parentElement.parentElement.insertBefore(r,n.parentElement.nextSibling);r.setAttribute("data-option",n.getAttribute("name"));r.classList.remove("hidden");return false}}if(o.length>0){o.forEach((function(e){e.disabled=true}))}if(a instanceof HTMLElement){a.classList.remove("hidden")}var p=new XMLHttpRequest,m=new FormData,f=n.parentElement.getAttribute("data-option"),u=n.checked;m.append("action","shortpixel_ai_handle_page_action");m.append("page","frontWorker");m.append("spainonce",document.querySelector(".spai__recommended-options-wrap").dataset.spainonce);m.append("data[option]",f);m.append("data[value]",u);p.onloadend=function(){var t=JSON.parse(p.response);if(t.success){if(o.length>0){o.forEach((function(e){if(e.checked===false){c=false}e.disabled=false}))}if(i instanceof HTMLElement){i.classList.remove("hidden")}if(!!f){window.SPAIFrontWorker.enabledOptions[f]=n.checked}for(var r in window.SPAIFrontWorker.enabledOptions){if(window.SPAIFrontWorker.enabledOptions[r]===false&&l instanceof HTMLElement){l.classList.add("hidden");break}}if(!!c){if(s instanceof HTMLElement){s.classList.add("hidden")}if(d instanceof HTMLElement){d.classList.remove("hidden")}}else{if(s instanceof HTMLElement){s.classList.remove("hidden")}if(d instanceof HTMLElement){d.classList.add("hidden")}}}e=false};if(!e){let t=ShortPixelAI.getAjaxUrl();p.open("post",!t?document.location.origin+"/wp-admin/admin-ajax.php":t);p.send(m);e=true}}}));document.addEventListener("click",(function(t){var n=t.target;if(n.matches(".spai-fw-sidebar__footer .collapse-button")||n.matches(".spai-fw-sidebar__footer .collapse-button *")){document.body.classList.add("spai-fw-sidebar-hidden")}if(n.matches(".spai-fw-maximize-button")||n.matches(".spai-fw-maximize-button *")){document.body.classList.remove("spai-fw-sidebar-hidden")}if(n.matches(".buttons-wrap button.cancel")){n.parentElement.parentElement.removeAttribute("data-option");n.parentElement.parentElement.classList.add("hidden")}if(n.matches(".buttons-wrap button.reload")){n.parentElement.classList.add("hidden");document.location.reload()}if(n.matches(".buttons-wrap button.revert")){var o=n.parentElement.parentElement.getAttribute("data-option");var r=document.querySelector('input[name="'+o+'"]'),i=n.parentElement.parentElement.parentElement.querySelector(".cache-message"),a=n.parentElement.parentElement.parentElement.querySelector(".no-options"),s=n.parentElement.parentElement.parentElement.querySelector(".has-recommendations"),d=n.parentElement.parentElement.parentElement.querySelector(".no-recommendations"),l=n.parentElement.parentElement.parentElement.parentElement.querySelector('.buttons-wrap[data-mission="general"]'),c=n.parentElement.parentElement.parentElement.querySelectorAll(".option input.tgl");if(c.length>0){c.forEach((function(e){e.disabled=true}))}if(r instanceof HTMLElement){var p=new XMLHttpRequest,m=new FormData;m.append("action","shortpixel_ai_handle_page_action");m.append("page","frontWorker");m.append("spainonce",document.querySelector(".spai__recommended-options-wrap").dataset.spainonce);m.append("data[option]",o);m.append("data[value]",false);p.onloadend=function(){var t=JSON.parse(p.response);if(t.success){r.checked=false;n.parentElement.parentElement.removeAttribute("data-option");n.parentElement.parentElement.classList.add("hidden");if(c.length>0){c.forEach((function(e){e.disabled=false}))}if(l instanceof HTMLElement){l.classList.remove("hidden")}if(i instanceof HTMLElement){i.classList.remove("hidden")}if(!!o){window.SPAIFrontWorker.enabledOptions[o]=false}if(a instanceof HTMLElement){a.classList.add("hidden")}if(s instanceof HTMLElement){s.classList.remove("hidden")}if(d instanceof HTMLElement){d.classList.add("hidden")}}e=false};if(!e){let t=ShortPixelAI.getAjaxUrl();p.open("post",!t?document.location.origin+"/wp-admin/admin-ajax.php":t);p.send(m);e=true}}n.parentElement.parentElement.removeAttribute("data-option");n.parentElement.parentElement.classList.add("hidden")}if(n.matches(".buttons-wrap button.continue")){var f=n.parentElement.parentElement.querySelectorAll(".option:not([data-activated]) input.tgl");if(f.length>0){f.forEach((function(e){e.disabled=false}))}else{var u=n.parentElement.parentElement.querySelectorAll(".option[data-activated]"),w=n.parentElement.querySelector("button.close"),d=n.parentElement.parentElement.querySelector(".spai__no-recommendations"),h=n.parentElement.parentElement.querySelector(".spai__recommended-options-wrap");u.forEach((function(e){e.parentNode.removeChild(e)}));h.classList.add("hidden");d.classList.remove("hidden");n.classList.add("hidden");w.classList.remove("hidden")}}if(n.matches(".buttons-wrap button.close")){n.parentElement.parentElement.parentElement.parentElement.classList.add("hidden")}if(n.matches(".buttons-wrap button.back")){var p=new XMLHttpRequest,m=new FormData;m.append("action","shortpixel_ai_handle_page_action");m.append("page","frontWorker");m.append("spainonce",document.querySelector(".spai__recommended-options-wrap").dataset.spainonce);m.append("data[action]","done");p.onloadend=function(){var t=JSON.parse(p.response);if(t.success){if(t.cookie!==""&&typeof window.Cookies==="object"&&typeof window.Cookies.get==="function"&&typeof window.Cookies.remove==="function"){window.Cookies.remove(t.cookie)}if(typeof t.redirect==="object"){if(!!t.redirect.allowed){document.location.href=t.redirect.url}}n.parentElement.parentElement.parentElement.parentElement.classList.add("hidden")}e=false};if(!e){let t=ShortPixelAI.getAjaxUrl();p.open("post",!t?document.location.origin+"/wp-admin/admin-ajax.php":t);p.send(m);e=true}}}))})();