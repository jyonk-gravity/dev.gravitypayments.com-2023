(function(t){document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("chart");if(!(t instanceof HTMLElement)){return false}var e=t.parentNode;var a=14;window.statusBox.chart.cdn.data.mb=window.statusBox.chart.cdn.data.mb.length<=a?window.statusBox.chart.cdn.data.mb:window.statusBox.chart.cdn.data.mb.slice(window.statusBox.chart.cdn.data.mb.length-a);window.statusBox.chart.cdn.labels=window.statusBox.chart.cdn.labels.length<=a?window.statusBox.chart.cdn.labels:window.statusBox.chart.cdn.labels.slice(window.statusBox.chart.cdn.labels.length-a);window.statusBox.chart.credits.labels=window.statusBox.chart.credits.labels.length<=a?window.statusBox.chart.credits.labels:window.statusBox.chart.credits.labels.slice(window.statusBox.chart.credits.labels.length-a);window.statusBox.chart.credits.data.paid=window.statusBox.chart.credits.data.paid.length<=a?window.statusBox.chart.credits.data.paid:window.statusBox.chart.credits.data.paid.slice(window.statusBox.chart.credits.data.paid.length-a);if(window.statusBox.chart.cdn.data.mb.length!==window.statusBox.chart.credits.data.paid.length){var n=window.statusBox.chart.cdn.data.mb.length>window.statusBox.chart.credits.data.paid.length?window.statusBox.chart.cdn.data.mb.length-window.statusBox.chart.credits.data.paid.length:window.statusBox.chart.credits.data.paid.length-window.statusBox.chart.cdn.data.mb.length,i=new Array(n).fill(0);if(window.statusBox.chart.cdn.data.mb.length>window.statusBox.chart.credits.data.paid.length){window.statusBox.chart.credits.data.paid=i.concat(window.statusBox.chart.credits.data.paid)}else{window.statusBox.chart.cdn.data.mb=i.concat(window.statusBox.chart.cdn.data.mb)}}var s=window.statusBox.chart.cdn.labels.length>=window.statusBox.chart.credits.labels.length?window.statusBox.chart.cdn.labels:window.statusBox.chart.credits.labels,o=window.statusBox.chart.cdn.data.mb,d=window.statusBox.chart.credits.data.paid;if(!e.classList.contains("expanded")){s=s.slice(s.length/2);o=o.slice(o.length/2);d=d.slice(d.length/2)}window.statusBox.chart.instance=new Chart(document.getElementById("chart").getContext("2d"),{type:"line",data:{labels:s,datasets:[{label:window.statusBox.chart.titles.cdn,borderColor:window.statusBox.chart.colors.cdn,backgroundColor:window.statusBox.chart.backgrounds.cdn,fill:true,pointHitRadius:10,data:o,yAxisID:"cdn"},{label:window.statusBox.chart.titles.credits,borderColor:window.statusBox.chart.colors.credits,backgroundColor:window.statusBox.chart.backgrounds.credits,fill:true,pointHitRadius:10,data:d,yAxisID:"credits"}]},options:{responsive:true,hoverMode:"index",stacked:false,legend:{position:"top",labels:{boxWidth:20,usePointStyle:true}},scales:{yAxes:[{type:"linear",display:true,position:"left",id:"cdn"},{type:"linear",display:true,position:"right",id:"credits",gridLines:{drawOnChartArea:false}}]}}})}));t((function(){t(".box_dropdown.spai_news").addClass("opened");e.loadNews();if(window.spaiModeSwitchNotification){e.showDecoratedNotice(window.spaiModeSwitchNotification)}}));var e={},a={};e.noticesQtyAtOneMoment=3;e.previousNotices=[];e.parseTab=function(t){if(t.indexOf("#top")===0){t=t.replace("#top","")}return t.indexOf("#")===0?t:false};e.prepareValue=function(t){var e=t.data("type"),a=t.prop("tagName").toLowerCase();switch(e){case"string":return a==="input"||a==="textarea"?t.val():undefined;case"int":return a==="input"?parseInt(t.val(),10):a==="textarea"?parseInt(t.text(),10):undefined;case"bool":return t.prop("checked");default:return undefined}};e.showDecoratedNotice=function(t){const a='<div class="notice notice-success is-dismissible" data-icon="none" data-causer=""\t\t\t\t\t\t\t\tdata-plugin="short-pixel-ai">\t\t\t\t<div class="body-wrap">\t\t\t\t\t<div class="message-wrap"><p>'+t+'</p></div>\t\t\t\t\t<div class="buttons-wrap"></div>\t\t\t\t</div>\t\t\t</div>';e.showNotice(a)};e.showNotice=function(e){if(typeof e!=="string"||e===""){return}var a=t("#wpbody .wrap h1"),n=t(".notice"),i=t(e).hide();if(n.length>0){n.last().after(i)}else{a.after(i)}this.previousNotices.push(i);if(this.previousNotices.length>this.noticesQtyAtOneMoment){for(var s=0;s<this.previousNotices.length-this.noticesQtyAtOneMoment;s++){var o=this.previousNotices[s];if(o===i)continue;o.slideUp("fast",(function(){o.remove()}));this.previousNotices.splice(s,1)}}t(document).trigger("wp-updates-notice-added");i.slideDown("fast",(function(){i.removeAttr("style");t("html:not(:animated), body:not(:animated)").animate({scrollTop:a.offset().top},500)}));setTimeout((function(){i.slideUp("fast",(function(){i.remove()}))}),2e4)};e.getAjaxUrl=function(){return typeof ajaxurl==="string"&&ajaxurl!==""?ajaxurl:"/wp-admin/admin-ajax.php"};e.topAction=function(a,n){var i={default:a.html(),onPress:a.attr("data-pressed-text")};t.ajax({method:"post",url:e.getAjaxUrl(),data:{action:"shortpixel_ai_handle_page_action",page:"settings",spainonce:t('[name="spainonce"]').val(),data:{action:n}},beforeSend:function(){a.text(i.onPress);a.prop("disabled",true)},success:function(t){if(typeof t.notice==="string"&&t.notice!==""){e.showNotice(t.notice)}a.prop("disabled",false);if(t.reload){window.location.href="options-general.php?page=shortpixel-ai-settings"}},complete:function(){a.html(i.default)}})};e.save=function(a){a.preventDefault();var n=t(this),i=n.find(".spai_settings_tab"),s=n.find('[type="submit"]');var o={};var d={url:n.attr("action"),method:n.attr("method")};var r={text:{default:s.val(),saving:s.data("saving-text")}};d.url=!d.url?e.getAjaxUrl():d.url;d.method=!d.method?"post":d.method;r.text.default=!r.text.default?"Save Changes":r.text.default;r.text.saving=!r.text.saving?"Saving...":r.text.saving;i.each((function(){var a=t(this),n=a.find("[name]");var i=a.attr("id");if(i){o[i]={}}n.each((function(){var a=t(this);var n=a.attr("type"),s=a.attr("name"),d=a.prop("checked");if(n==="radio"){if(d){o[i][s]=e.prepareValue(a)}}else{o[i][s]=e.prepareValue(a)}}))}));t.ajax({url:d.url,method:d.method,dataType:"json",data:{action:"shortpixel_ai_handle_page_action",page:"settings",spainonce:n.find('[name="spainonce"]').val(),data:{action:"save",options:JSON.stringify(o)}},beforeSend:function(){if(r.text.saving){s.prop("disabled",true);s.val(r.text.saving)}},success:function(a){if(typeof a.notice==="string"&&a.notice!==""){e.showNotice(a.notice);if(t('div.notice[data-causer="twicelossy"]').length&&!t("input#lossy").is(":checked")){t('div.notice[data-causer="twicelossy"]').remove()}}},complete:function(){if(r.text.default){s.prop("disabled",false);s.val(r.text.default)}}})};e.updateChartData=function(){var t=window.statusBox.chart.instance,e=window.statusBox.chart.cdn.labels.length>=window.statusBox.chart.credits.labels.length?window.statusBox.chart.cdn.labels:window.statusBox.chart.credits.labels,a=window.statusBox.chart.cdn.data.mb,n=window.statusBox.chart.credits.data.paid;if(!t.canvas.parentNode.classList.contains("expanded")){e=e.slice(e.length/2);a=a.slice(a.length/2);n=n.slice(n.length/2)}t.data.labels=e;t.data.datasets=[{label:window.statusBox.chart.titles.cdn,borderColor:window.statusBox.chart.colors.cdn,backgroundColor:window.statusBox.chart.backgrounds.cdn,fill:true,pointHitRadius:10,data:a,yAxisID:"cdn"},{label:window.statusBox.chart.titles.credits,borderColor:window.statusBox.chart.colors.credits,backgroundColor:window.statusBox.chart.backgrounds.credits,fill:true,pointHitRadius:10,data:n,yAxisID:"credits"}]};e.loadNews=function(){if(!t(".box_dropdown.spai_news").hasClass("processed")){t("#spaiNewsFeed").addClass("loading");const e=`https://shortpixel.com/blog/feed/`;fetch(e).then((t=>t.text())).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((e=>{t("#spaiNewsFeed").removeClass("loading");t(".box_dropdown.spai_news").addClass("processed");const a=e.querySelectorAll("item");for(let t in a){n(a[t]);if(t>1)break}function n(t){const e=t.querySelector("description").textContent;const a=document.createElement("div");a.innerHTML=e;let n=a.querySelector("img");let i=n?n.outerHTML:"";let s=a.innerText.replace("→","").substring(0,500)+"…";const o=`\n<article class="item">\n    <h3><a href="${t.querySelector("link").innerHTML}" target="_blank">${t.querySelector("title").innerHTML}</a></h3>\n    <div class="image"><a href="${t.querySelector("link").innerHTML}" target="_blank">${i}</a></div>\n    <div class="description">${s}</div>\n    <div class="link"><a href="${t.querySelector("link").innerHTML}" target="_blank">${document.querySelector(".box_dropdown.spai_news").getAttribute("data-readmore")}</a></div>\n</article>`;document.querySelector("#spaiNewsFeed").innerHTML+=o}}))}};a.validateSelector=function(t){try{t=t.replace(/\.([^\.]*)\*/,".$1");document.querySelector(t);return true}catch(t){return false}};a.prepare=function(){var e=t('[ data-setting="exclusion"]');e.each((function(){var e=t(this),a=e.data("texts"),n=e.val();if(typeof a!=="object"){a={add:"Add",save:"Save"}}var i=e.data("separator"),s=e.data("exclusion-type");i=typeof i==="string"&&i!==""?i:",";s=typeof s==="string"&&s!==""?s:"selectors";var o=typeof n==="string"&&n!==""?n.split(typeof i==="string"&&i!==""?i:","):[],d="";for(var r=0,c=o[r];r<o.length;c=o[++r]){d+='<div data-index="'+r+'" data-action="edit"><span class="selector">'+c+'</span><span data-action="delete"></span></div>'}var l=t('<div class="exclusion-wrap" data-type="'+s+'">'+'<div class="exclusions-content clearfix" data-action="add"><div class="plus"></div>'+d+"</div>"+'<div class="buttons-wrap hidden">'+'<div class="error-message hidden"></div>'+(s==="urls"?'<select><option value="path">Path</option><option value="regex">RegEx</option><option value="http">HTTP</option><option value="https">HTTPS</option><option value="domain">Domain</option></select> : ':"")+'<input type="text"><button type="button" class="dark_blue_link" data-action="confirm" data-texts='+JSON.stringify(a)+">"+a.add+"</button></div></div>");e.before(l);l.append(e)}))};a.updateRealField=function(e,a){var n=[],i=e.data("separator");i=typeof i==="string"&&i!==""?i:",";if(a.length>0){a.each((function(){n.push(t(this).text())}))}e.val(n.join(i))};a.updateWarningMessage=function(t,e){var a=parseInt(t.data("limit"),10);t.find("span").text(e);if(e>a){t.slideDown("fast")}else{t.slideUp("fast")}};a.inputActionsHandler=function(e){var a=t(this),n=a.siblings("select"),i=n.find("option"),s=a.siblings("button");if(e.type==="keypress"){var o=["Enter"];if(o.includes(e.key)){e.preventDefault();e.stopPropagation();s.click()}}else if("input"||"focus"||"blur"||"change"){if(n.length===0){return}var d=a.val(),r=[];if(i.length>0){i.each((function(){r.push(t(this).val())}))}r.forEach((function(t){if(d.indexOf(t+":")===0){a.val(d.replace(t+":",""));n.val(t)}}))}};a.actionsHandler=function(e){e.preventDefault();e.stopPropagation();var n=t(this),i=n.parents("td"),s=i.find("p.warning"),o=n.parents(".exclusion-wrap"),d=o.find("textarea"),r=o.find(".buttons-wrap"),c=r.find(".error-message"),l=r.find("input"),p=r.find("select"),u=r.find("button"),f=o.find(".exclusions-content"),h=f.find(".selector"),g=f.find("div[data-index]");var v=l.val(),w=u.attr("data-texts"),x=n.attr("data-action"),b=n.attr("data-state");var m=d.data("exclusion-type");if(v.indexOf("<")>=0){alert("Invalid input, please check and try again.");return}v=typeof v==="string"&&v!==""?v.trim():"";x=typeof x==="string"&&x!==""?x:undefined;b=x==="confirm"&&typeof b==="string"&&b!==""?b:"add";m=typeof m==="string"&&m!==""?m:"selectors";try{w=JSON.parse(w)}catch(t){w={add:"Add",save:"Save"}}switch(x){case"add":u.text(w.add).attr("data-state","add").removeAttr("data-editing");l.removeClass("error").val("");r.slideDown("fast");c.text("").slideUp("fast");l.focus();break;case"edit":var y=n.find(".selector");l.removeClass("error").val(y.text());u.text(w.save).attr("data-state","save").attr("data-editing",n.attr("data-index"));r.slideDown("fast");c.text("").slideUp("fast");l.focus();break;case"delete":n.parents("div[data-index]").fadeOut("fast",(function(){t(this).remove();a.updateWarningMessage(s,i.find(".selector").length);a.updateRealField(d,f.find(".selector"))}));u.removeAttr("data-editing").removeAttr("data-state");r.slideUp("fast");l.removeClass("error").val("");c.text("").slideUp("fast");break;case"confirm":var _=p.val(),B=false,k=m==="urls"?_+":"+v:v,C=m==="urls"?[k]:k.split(",");C=C.map((function(t){return typeof t==="string"?t.trim():t}));if(m==="selectors"&&!a.validateSelector(v)){l.addClass("error");c.html(window.exclusionsL10n.messages.selectors.invalid).slideDown("fast");break}for(var A=0,y=t(h[A]);A<h.length;y=t(h[++A])){var S=y.text();C=C.filter((function(t){return b==="save"&&y.parent().attr("data-index")===n.attr("data-editing")&&S===t||S!==t}));if(C.length<=0){B=true;l.addClass("error");c.html(window.exclusionsL10n.messages.selectors.alreadyExists).slideDown("fast");break}}if(!!B){break}var N=function(e,a){var n=t('<div data-index="'+(j+a)+'" data-action="edit" class="hidden"><span class="selector">'+e+'</span><span data-action="delete"></span></div>');f.append(n);n.fadeIn("fast")};if(b==="add"&&v!==""&&C.length>0){var j=g.length>0?parseInt(g.last().attr("data-index"),10)+1:0;C.map(N)}else if(b==="save"&&v!==""&&C.length>0){var j=n.attr("data-editing");f.find('div[data-index="'+j+'"] .selector').text(C.shift());if(C.length>0){j=g.length>0?parseInt(g.last().attr("data-index"),10)+1:0;C.map(N)}}r.slideUp("fast");l.removeClass("error").val("");c.text("").slideUp("fast");u.removeAttr("data-editing").removeAttr("data-state");break}a.updateWarningMessage(s,i.find(".selector").length);a.updateRealField(d,f.find(".selector"))};t((function(){var n=t(this);if(document.location.hash!==""){var i=t('a[href="'+document.location.hash+'"]');t("#wpspai-tabs a.nav-tab").removeClass("nav-tab-active");t(".spai_settings_tab").removeClass("active");var s=e.parseTab(i.attr("href"));if(!!s){var o=t(s);if(o.length>0){i.addClass("nav-tab-active");o.addClass("active");if(typeof window.Beacon==="function"&&typeof window.beaconConstants==="object"){var d=o.attr("id");if(typeof window.beaconConstants.suggestions[d]!=="undefined"){window.Beacon("suggest",window.beaconConstants.suggestions[d])}}}}}a.prepare();n.on("click",".exclusion-wrap [data-action]",a.actionsHandler);n.on("change focus blur input keypress",".exclusion-wrap input",a.inputActionsHandler);n.on("submit","form#settings-form",e.save);n.on("click",".chart-wrap .toggle",(function(){t(this).parent().toggleClass("expanded");e.updateChartData()}));n.on("dblclick",".chart-wrap canvas",(function(){if(window.matchMedia("(min-width : 850px)").matches){t(this).parent().toggleClass("expanded");e.updateChartData()}}));n.on("click","#wpspai-tabs a.nav-tab",(function(a){var n=t(this);t("#wpspai-tabs a.nav-tab").removeClass("nav-tab-active");t(".spai_settings_tab").removeClass("active");var i=e.parseTab(n.attr("href"));if(!!i){var s=t(i);if(s.length>0){n.addClass("nav-tab-active");s.addClass("active");if(typeof window.Beacon==="function"&&typeof window.beaconConstants==="object"){var o=s.attr("id");if(typeof window.beaconConstants.suggestions[o]!=="undefined"){window.Beacon("suggest",window.beaconConstants.suggestions[o])}}}}}));n.on("change",'input[type="radio"]',(function(){var e=t(this);var a=e.val();if(typeof a==="string"&&a!==""){var n=e.parent(),i=n.siblings('p[data-explanation="'+a+'"]'),s=n.siblings("p[data-explanation]").not(i),o=n.siblings('.children-wrap[data-parent="'+a+'"]'),d=n.siblings(".children-wrap[data-parent]").not(o);s.addClass("hidden");i.removeClass("hidden");d.addClass("hidden");o.removeClass("hidden")}}));var r=function(){var e=t(this),a=e.parent("[data-depended]"),n=a.siblings("[data-depended]"),i=n.find('input[type="checkbox"]:checked'),s=e.siblings(".notification_popup");if(e.hasClass("spai_triggers_notification")||e.prop("checked")&&s.length>0){s.removeClass("hidden");e.prop("checked",false);e.removeClass("spai_triggers_notification")}else{var o=e.parent().find("input[data-depender]:checked").length;if(o){e.siblings(".children-wrap").removeClass("hidden");e.siblings("[data-depended]").find('input[type="checkbox"]').prop("checked",true)}else{e.siblings(".children-wrap").addClass("hidden");if(a.length>0){if(i.length===0){var d=a.data("depended");d=typeof d==="string"&&d!==""?d.split("|"):[];var r="";for(let t in d){r+='input[name="'+d[t]+'"],'}var c=t(r.slice(0,-1));console.log(a,c);c.prop("checked",false).siblings(".children-wrap").addClass("hidden")}}}}};n.on("change",'input[type="checkbox"]',r);n.on("keydown","input.spai_triggers_notification",r);n.on("paste","input.spai_triggers_notification",r);n.on("click",'.notification_popup input[type="button"]',(function(){var e=t(this),a=e.parent(".notification_popup"),n=a.siblings(".children-wrap"),i=a.siblings('input[type="checkbox"]');i.prop("checked",true);n.removeClass("hidden");a.addClass("hidden")}));n.on("click",".box_dropdown .title",(function(){t(this).parent().toggleClass("opened")}));n.on("click",".spai_statusbox_wrap .title_wrap",(function(){if(document.body.clientWidth<=850){var e=t(this),a=e.parent(),n=a.find(".box_content");a.toggleClass("expanded");n.slideToggle("fast")}}));n.on("click","#clear_css_cache",(function(a){e.topAction(t(this),"clear css cache")}));n.on("click","#purge_cdn_cache",(function(a){e.topAction(t(this),"purge_cdn_cache")}));n.on("click","#export_settings, .export-settings",(function(e){var a=t("#import_spainonce").val();window.location.href="admin.php?page=shortpixel-ai-export-settings&spainonce="+a+"&noheader=true"}));n.on("change","#spai_settings_advanced",(function(a){if(!t("#spai_settings_advanced").prop("checked")&&!t("#spai_settings_advanced").data("popup-confirmed")){t("#spai_settings_advanced").prop("checked",true);jQuery.spaiHelpOpenLocal(t(a.target).siblings(".spai_settings_advanced_popup"))}else{e.topAction(t(".shortpixel-settings-tabs"),"enable advanced");t(".shortpixel-settings-wrap").fadeOut("fast");t(".wpf-settings").addClass("spai-loading")}}));n.on("click","#spaiHelp .spai_settings_advanced_popup .button-yes",(function(a){e.topAction(t(".shortpixel-settings-tabs"),"disable advanced");t("#spai_settings_advanced").prop("checked",false);t(".shortpixel-settings-wrap").fadeOut("fast");t(".wpf-settings").addClass("spai-loading")}));n.on("click","#spaiHelp .spai_settings_advanced_popup .button-no",(function(t){jQuery.spaiHelpClose()}));var c;if(c=document.getElementById("import_settings_file")){c.addEventListener("change",(function(){if(this.files&&this.files[0]){var t=new FileReader;t.onload=t=>{try{var e=JSON.parse(t.target.result);if(typeof e!=="object"){throw"noobj"}if(window.confirm("Load these settings? \n"+t.target.result)){document.getElementById("import_settings_form").submit()}}catch(t){alert("This file doesn't look like a SPAI Settings export.")}};t.readAsText(this.files[0])}}))}n.on("submit","form#api-key-form",(function(a){a.preventDefault();var n=t(this),i=n.find('[name]:not([type="hidden"])'),s=n.find('[type="submit"]');var o={url:n.attr("action"),method:n.attr("method")};var d={text:{default:s.val(),saving:s.data("saving-text")}};var r=false;i.each((function(){var e=t(this),a=e.val();if(typeof a==="string"&&a!==""){r=true}}));if(!r){return}o.url=!o.url?e.getAjaxUrl():o.url;o.method=!o.method?"post":o.method;d.text.default=!d.text.default?"Save":d.text.default;d.text.saving=!d.text.saving?"Saving...":d.text.saving;t.ajax({method:o.method,url:o.url,data:n.serialize(),beforeSend:function(){s.text(d.text.saving);s.prop("disabled",true)},success:function(t){if(t.success){if(t.reload){document.location.reload()}}else if(t.notice){e.showNotice(t.notice)}},complete:function(){s.text(d.text.default);s.prop("disabled",false)}})}));n.on("click",'.spai_statusbox_wrap div:not(".dismissed-notice") [data-action], .spai_settings_tab div:not(".dismissed-notice") [data-action]',(function(a){a.preventDefault();if(t(a.target).closest(".dismissed-notice").length>0){return}var n=t(this);var i=n.attr("data-action"),s=n.prop("tagName").toLowerCase();i=typeof i==="string"||i!==""?i:undefined;t.ajax({method:"post",url:e.getAjaxUrl(),data:{action:"shortpixel_ai_handle_page_action",page:"settings",spainonce:t('[name="spainonce"]').val(),data:{action:i}},beforeSend:function(){if(s==="button"||s==="input"){n.prop("disabled",true)}},success:function(t){if(t.success){if(t.reload){document.location.reload()}}if(t.notice){e.showNotice(t.notice)}},complete:function(){if(s==="button"||s==="input"){n.prop("disabled",false)}}})}))}))})(jQuery);